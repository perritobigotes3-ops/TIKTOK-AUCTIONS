<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Overlay Subasta 14alls</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{--accent:#ff5c7c;--bg:rgba(0,0,0,0);--text:#fff}
    body{margin:0;font-family:Inter,Arial,Helvetica,sans-serif;background:transparent;color:var(--text);-webkit-font-smoothing:antialiased}
    .wrap{width:900px;padding:18px;display:flex;flex-direction:column;align-items:center;gap:6px}
    #timer{font-size:120px;font-weight:800;color:var(--accent);text-shadow:0 6px 18px rgba(0,0,0,0.6)}
    #vs{font-size:44px;color:#ffd966;margin:6px}
    #winner{font-size:48px;color:#00ff99;margin-top:10px;display:none}
    #donations{width:100%;max-width:820px;margin-top:12px}
    .donation{display:flex;justify-content:space-between;padding:8px;border-radius:8px;margin-bottom:8px;align-items:center;color:#000;font-weight:700;animation:pop 0.7s ease}
    .donation .left{display:flex;gap:12px;align-items:center}
    .donation .user{font-size:20px}
    .donation .coins{font-size:18px;opacity:0.95}
    @keyframes pop{0%{opacity:0;transform:translateY(-30px) scale(.95)}100%{opacity:1;transform:translateY(0) scale(1)}}
  </style>
</head>
<body>
  <div class="wrap">
    <div id="timer">00:00</div>
    <div id="vs"></div>
    <div id="winner"></div>
    <div id="donations"></div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const timerEl = document.getElementById('timer');
    const vsEl = document.getElementById('vs');
    const winnerEl = document.getElementById('winner');
    const donationsEl = document.getElementById('donations');

    function formatTime(sec){
      const m = String(Math.floor(sec/60)).padStart(2,'0');
      const s = String(sec%60).padStart(2,'0');
      return m + ':' + s;
    }

    socket.on('state', (s)=>{
      timerEl.textContent = formatTime(s.timer.remaining || s.timer.duration);
      // participants top 5
      const parts = Object.entries(s.participants || {}).sort((a,b)=>b[1]-a[1]);
      if(parts.length>0){
        const p1 = parts[0][0];
        const p2 = parts[1] ? parts[1][0] : null;
        vsEl.textContent = p2 ? `${p1} üÜö ${p2}` : `${p1} esperando rival...`;
      } else vsEl.textContent = '';
      // recent donations
      donationsEl.innerHTML = (s.recentDonations||[]).map(d=>`<div class="donation" style="background:${d.color}"><div class="left"><div class="user">${d.username}</div></div><div class="coins">${d.coins} üíé</div></div>`).join('');
    });

    socket.on('donationLive', (d)=>{
      // show single animated donation at top
      const div = document.createElement('div');
      div.className = 'donation';
      div.style.background = d.color;
      div.innerHTML = `<div class="left"><div class="user">${d.username}</div></div><div class="coins">${d.coins} üíé</div>`;
      donationsEl.prepend(div);
      // keep recent 12
      while(donationsEl.children.length>12) donationsEl.removeChild(donationsEl.lastChild);
      // flash winner if needed
    });

    socket.on('auctionEnd', (data)=>{
      winnerEl.style.display = 'block';
      winnerEl.textContent = data.winner ? `üèÜ GANADOR: ${data.winner} ‚Äî ${data.coins} üíé` : '‚è∞ Sin ganador';
    });

    // request initial state
    socket.emit('reqState');
  </script>
</body>
</html>
